<%- include('../partials/header', { title: title }) %>

<div class="container my-5">
  <h1 class="h4 mb-4">Request New Event</h1>
  <% if (error) { %><div class="alert alert-danger"><%= error %></div><% } %>
  <form id="eventRequestForm" class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Class</label>
      <select name="classId" class="form-select" required>
        <option value="">Select class</option>
        <% classes.forEach(c => { %>
          <option value="<%= c.id %>"><%= c.name %> (<%= c.grade %> <%= c.section %>)</option>
        <% }) %>
      </select>
    </div>
    <div class="col-md-6">
      <label class="form-label">Event Type</label>
      <input name="event_type" class="form-control" placeholder="e.g., Sports" required />
    </div>
    <div class="col-md-6">
      <label class="form-label">Title</label>
      <input name="title" class="form-control" required />
    </div>
    <div class="col-md-6">
      <label class="form-label">Location</label>
      <input name="location" class="form-control" required />
    </div>
    <div class="col-12">
      <label class="form-label">Description</label>
      <textarea name="description" class="form-control" rows="3"></textarea>
    </div>
    <div class="col-md-4">
      <label class="form-label">Start Date</label>
      <input type="datetime-local" name="start_date" class="form-control" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">End Date</label>
      <input type="datetime-local" name="end_date" class="form-control" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">Registration Deadline</label>
      <input type="datetime-local" name="registration_deadline" class="form-control" />
    </div>
    <div class="col-md-4">
      <label class="form-label">Fee</label>
      <input type="number" step="0.01" name="fee" class="form-control" value="0" />
    </div>
    <div class="col-12">
      <button class="btn btn-primary" type="submit">Submit Request</button>
    </div>
  </form>
</div>

<script>
document.getElementById('eventRequestForm').addEventListener('submit', function(e){
  e.preventDefault();
  const formData = new FormData(this);
  const data = Object.fromEntries(formData.entries());
  fetch('/teachers/event-requests', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(r => r.json()).then(res => {
    if (res.success) { alert('Request submitted'); window.location.href = '/teachers/dashboard'; }
    else { alert(res.message || 'Failed'); }
  }).catch(() => alert('Failed'));
});
</script>

<%- include('../partials/footer') %>

